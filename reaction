import tkinter as tk
import random
import time

class ReactionGame:
    def __init__(self, root):
        self.root = root
        self.root.title("âš¡ìˆœë°œë ¥")
        self.root.geometry("500x720")
        self.root.resizable(False, False)
        
        self.records = []
        self.start_time = 0
        self.timer_id = None
        
        # 30ê°€ì§€ ê³ ìœ  ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        self.target_colors = [
            "#FF5733", "#33FF57", "#3357FF", "#F333FF", "#FF33A1", "#00F5FF", "#FFD700", "#FF8C00", "#8A2BE2", "#00FF7F",
            "#FF1493", "#00CED1", "#ADFF2F", "#FF4500", "#7B68EE", "#1ABC9C", "#2ECC71", "#3498DB", "#9B59B6", "#F1C40F",
            "#E67E22", "#E74C3C", "#16A085", "#27AE60", "#2980B9", "#8E44AD", "#F39C12", "#D35400", "#C0392B", "#BDC3C7"
        ]
        
        self.label_info = tk.Label(root, text="3íšŒ í‰ê· ìœ¼ë¡œ ë“±ê¸‰ ê²°ì •", font=("Malgun Gothic", 14, "bold"))
        self.label_info.pack(pady=15)
        
        self.canvas = tk.Canvas(root, width=440, height=380, bg="#1a1a1a", highlightthickness=3, highlightbackground="#444")
        self.canvas.pack(pady=10)
        self.canvas.bind("<Button-1>", self.handle_click)
        
        self.status_text = self.canvas.create_text(220, 170, text="READY?", font=("Arial", 35, "bold"), fill="white")
        self.sub_text = self.canvas.create_text(220, 230, text="í™”ë©´ì„ í´ë¦­í•˜ë©´ ì‹œì‘", font=("Malgun Gothic", 11), fill="#888")
        
        self.result_box = tk.Text(root, width=55, height=14, state='disabled', font=("Consolas", 10), bg="#f0f0f0", fg="#222")
        self.result_box.pack(pady=15)
        
        self.game_state = "WAITING"

    def handle_click(self, event):
        if self.game_state == "WAITING":
            self.start_ready()
        elif self.game_state == "READY":
            self.too_early()
        elif self.game_state == "NOW":
            self.end_attempt()
        elif self.game_state == "FINISHED":
            self.reset_game()

    def start_ready(self):
        self.game_state = "READY"
        self.canvas.config(bg="#1a1a1a")
        self.canvas.itemconfig(self.status_text, text="ì§‘ì¤‘í•˜ì„¸ìš”", fill="white")
        self.canvas.itemconfig(self.sub_text, text="ì–¸ì œ ë³€í• ì§€ ëª¨ë¦…ë‹ˆë‹¤...", fill="#666")
        
        # ì •ë°€ ì†Œìˆ˜ì  ëŒ€ê¸° ì‹œê°„
        wait_time_ms = int(random.uniform(1.3, 4.9) * 1000)
        self.timer_id = self.root.after(wait_time_ms, self.show_target)

    def too_early(self):
        if self.timer_id:
            self.root.after_cancel(self.timer_id)
        self.game_state = "WAITING"
        self.canvas.config(bg="#96281b")
        self.canvas.itemconfig(self.status_text, text="ë¶€ì • ì¶œë°œ!", fill="white")
        self.canvas.itemconfig(self.sub_text, text="ì˜ˆì¸¡í•˜ì§€ ë§ˆì„¸ìš”. ë³´ê³  ëˆ„ë¥´ì„¸ìš”!", fill="white")

    def show_target(self):
        self.game_state = "NOW"
        self.canvas.config(bg=random.choice(self.target_colors))
        self.canvas.itemconfig(self.status_text, text="NOW!!", fill="white")
        self.canvas.itemconfig(self.sub_text, text="ì§€ê¸ˆ ë‹¹ì¥!", fill="white")
        self.start_time = time.time()

    def end_attempt(self):
        elapsed = time.time() - self.start_time
        self.records.append(elapsed)
        self.update_log(f"#{len(self.records)} ê¸°ë¡: {elapsed:.4f}s\n")
        
        if len(self.records) < 2:
            self.game_state = "WAITING"
            self.canvas.config(bg="#1a1a1a")
            self.canvas.itemconfig(self.status_text, text=f"{elapsed:.3f}s", fill="#2ecc71")
            self.canvas.itemconfig(self.sub_text, text="ë‹¤ìŒ ì‹œë„ë¥¼ ìœ„í•´ í´ë¦­", fill="#888")
        else:
            self.show_final_report()

    def update_log(self, message):
        self.result_box.config(state='normal')
        self.result_box.insert(tk.END, message)
        self.result_box.config(state='disabled')
        self.result_box.see(tk.END)

    def show_final_report(self):
        self.game_state = "FINISHED"
        avg = sum(self.records) / 2
        best = min(self.records)
        sorted_res = sorted(self.records)

        if avg <= 0.170:
            rank = "[ì‹ ê³„] ë‰´íƒ€ì…"
            comment = "ì‹ ê²½ê³„ê°€ ê´‘ì„¬ìœ ì´ì‹ ê°€ìš”?"
        elif avg <= 0.215:
            rank = "[ì¥ë¹„ë¹¨] ìƒìœ„ 0.1%"
            comment = "ì†ê°€ë½ì´ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤!"
        elif avg <= 0.255:
            rank = "[ê²Œì´ë¨¸] í˜„ì—­ í”„ë¡œê¸‰"
            comment = "ì¤€ìˆ˜í•œ í”¼ì§€ì»¬ì„ ê°€ì¡Œêµ°ìš”."
        elif avg <= 0.320:
            rank = "[ì¼ë°˜ì¸] ê°“ íƒœì–´ë‚œ ì‚¬ìŠ´"
            comment = "ê±´ê°•í•œ ì¼ë°˜ì¸ì…ë‹ˆë‹¤."
        else:
            rank = "[ì„íšŒí™”] ë‚˜ë¬´ëŠ˜ë³´"
            comment = "ë§ˆìš°ìŠ¤ê°€ ê³ ì¥ë‚œ ê±´ ì•„ë‹ê¹Œìš”?"

        self.canvas.config(bg="#2c3e50")
        self.canvas.itemconfig(self.status_text, text=rank, fill="white", font=("Malgun Gothic", 22, "bold"))
        self.canvas.itemconfig(self.sub_text, text=f"{comment}\ní‰ê· : {avg:.4f}s / ìµœê³ : {best:.4f}s", fill="white", font=("Malgun Gothic", 12))
        
        self.update_log("\n--- ğŸ íƒ€ì´íŠ¸í•œ ìµœì¢… ë¦¬í¬íŠ¸ ---\n")
        for i, r in enumerate(sorted_res, 1):
            self.update_log(f"{i}ìœ„: {r:.4f}ì´ˆ\n")
        self.update_log(f"ìµœì¢… í‰ê· : {avg:.4f}s\në“±ê¸‰: {rank}\n---------------------------\n")

    def reset_game(self):
        self.records = []
        self.result_box.config(state='normal')
        self.result_box.delete('1.0', tk.END)
        self.result_box.config(state='disabled')
        self.game_state = "WAITING"
        self.canvas.config(bg="#1a1a1a")
        self.canvas.itemconfig(self.status_text, text="RETRY?", fill="white")
        self.canvas.itemconfig(self.sub_text, text="ë‹¤ì‹œ ë„ì „í•˜ë ¤ë©´ í´ë¦­í•˜ì„¸ìš”", fill="#888")

if __name__ == "__main__":
    root = tk.Tk()
    game = ReactionGame(root)
    root.mainloop()
